(()=>{"use strict";var e={811:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),r(469);const s=u(r(252)),a=u(r(96)),l=u(r(577)),d=u(r(525)),c=u(r(898)),f=i(r(140)),p=u(r(715)),v=u(r(418)),_=(0,s.default)();_.use((0,d.default)()),_.use((0,a.default)("dev")),_.use((0,l.default)({origin:[v.default.CLIENT_URL],credentials:!0})),_.use((0,c.default)(v.default.COOKIE_SECRET)),_.use(s.default.json()),_.use(s.default.urlencoded({extended:!0})),_.get("/",((e,t)=>t.status(200).send('\n<div style="display: flex; align-items: center; justify-content: center; height: 90vh"> \n<h1 style="font-size: 72px; background: -webkit-linear-gradient(45deg, #09009f, #00ff95 80%); -webkit-background-clip: text;\n-webkit-text-fill-color: transparent;">SYNAPSE REST API</h1>\n</div>\n'))),_.use("/user",p.default),_.use(((e,t,r)=>r((0,f.default)(404,"Endpoint not found")))),_.use(((e,t,r,n)=>{console.error(e);let o="An unknown error occurred",i=500;(0,f.isHttpError)(e)&&(i=e.status,o=e.message),r.status(i).json(o)})),t.default=_},435:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function u(e){try{a(n.next(e))}catch(e){i(e)}}function s(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,s)}a((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(548),u=r(729),s=o(r(140)),a=o(r(297));t.default=(0,i.Controller)({register(e,t){return n(this,void 0,void 0,(function*(){const{email:r,password:n,skillName:o,skillLevel:i}=e.body;if(yield a.default.user.findFirst({where:{email:r}}))throw(0,s.default)(403,"Account already exists, please login");const l=yield(0,u.hash)(n,10),d=yield a.default.user.create({data:Object.assign(Object.assign({},e.body),{password:l})}),{email:c,id:f}=d;return t.status(200).json({message:"Sign up successful",userId:f})}))},logout(e,t){return n(this,void 0,void 0,(function*(){yield e.logout(),t.status(200).send("Logout successful")}))},resendVerificationCode(e,t){return n(this,void 0,void 0,(function*(){return t.status(200).json("Okay")}))}})},156:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(r(811)),i=n(r(418)).default.PORT;o.default.listen(i,(()=>console.log("Listening on PORT "+i)))},138:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function u(e){try{a(n.next(e))}catch(e){i(e)}}function s(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,s)}a((n=n.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.logout=t.authenticate=t.verifyUser=void 0;const i=o(r(140)),u=o(r(297)),s=r(548),a=o(r(829)),l=o(r(418)),d=(0,s.asyncWrapper)(((e,t,r)=>n(void 0,void 0,void 0,(function*(){e.logout=()=>n(void 0,void 0,void 0,(function*(){return t.clearCookie("session.token",{signed:!0,sameSite:"none",secure:!0}),!0})),r()}))));t.logout=d;const c=(0,s.asyncWrapper)(((e,t,r)=>n(void 0,void 0,void 0,(function*(){const t=e.body.userId||e.params.userId;if(!t)throw(0,i.default)(403,"Invalid ID");const n=yield u.default.user.findUnique({where:{id:t}});if(!n)throw(0,i.default)(404,"User not found");e.user=n,r()}))));t.verifyUser=c;const f=(0,s.Controller)({user(e,t,r){return n(this,void 0,void 0,(function*(){const t=e.cookies.jwt;if(!t)throw(0,i.default)(401,"Unauthorized - No token provided");const n=a.default.verify(t,l.default.JWT_SECRET);if(!n)throw(0,i.default)(401,"Session expired");const o=yield u.default.user.findUnique({where:{id:n}});if(!o)throw(0,i.default)(404,"User not found");e.user=o,r()}))}});t.authenticate=f},715:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(252),i=n(r(435)),u=r(138),{user:s}=u.authenticate,a=(0,o.Router)();a.use(u.logout),a.post("/register",i.default.register),a.post("/logout",i.default.logout),t.default=a},297:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(330);let o;global.__prisma||(global.__prisma=new n.PrismaClient),o=global.__prisma,t.default=o},418:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(991);t.default=(0,n.cleanEnv)(process.env,{PORT:(0,n.port)(),JWT_SECRET:(0,n.str)(),DATABASE_URL:(0,n.str)(),COOKIE_SECRET:(0,n.str)(),CLIENT_URL:(0,n.str)()})},548:function(e,t){var r=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function u(e){try{a(n.next(e))}catch(e){i(e)}}function s(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,s)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Controller=t.asyncWrapper=void 0;t.asyncWrapper=e=>(t,n,o)=>r(void 0,void 0,void 0,(function*(){try{yield e(t,n,o)}catch(e){o(e)}}));t.Controller=e=>{for(let r of Object.keys(e))e[r]=(0,t.asyncWrapper)(e[r]);return e}},330:e=>{e.exports=require("@prisma/client")},729:e=>{e.exports=require("bcryptjs")},898:e=>{e.exports=require("cookie-parser")},577:e=>{e.exports=require("cors")},469:e=>{e.exports=require("dotenv/config")},991:e=>{e.exports=require("envalid")},252:e=>{e.exports=require("express")},525:e=>{e.exports=require("helmet")},140:e=>{e.exports=require("http-errors")},829:e=>{e.exports=require("jsonwebtoken")},96:e=>{e.exports=require("morgan")}},t={};(function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports})(156)})();
//# sourceMappingURL=index.js.map